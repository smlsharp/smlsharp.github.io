<!DOCTYPE html><html>
<head>
<title>14.4 Opaque types‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0</title>
<!--Generated on Tue Mar 25 14:56:23 2025 by LaTeXML (version 0.8.5) http://dlmf.nist.gov/LaTeXML/.-->
<!--Document created on Mar, 2025.-->

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="LaTeXML.css" type="text/css">
<link rel="stylesheet" href="ltx-book.css" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=MML_CHTML" type="text/javascript"></script>
<link rel="up" href="Ch14.html" title="Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="up up" href="Pt2.html" title="Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="up up up" href="./" title="SML# Document Version 4.2.0">
<link rel="start" href="./" title="SML# Document Version 4.2.0">
<link rel="prev" href="Ch14.S3.html" title="14.3 Structure of interface files ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="next" href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S1.html" title="14.1 Separate compilation overview ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S2.html" title="14.2 Separate compilation example ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S3.html" title="14.3 Structure of interface files ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S6.html" title="14.6 Functor support ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S7.html" title="14.7 Replications ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="section" href="Ch14.S8.html" title="14.8 Top-level execution ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch5.html" title="Chapter 5 Installing SML# ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch6.html" title="Chapter 6 Setting up SML# programming environment ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch7.html" title="Chapter 7 Introduction to ML programming ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch8.html" title="Chapter 8 SML# feature: record polymorphism ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch9.html" title="Chapter 9 SML# feature: other type system extensions ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch10.html" title="Chapter 10 SML# feature: direct interface to C ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch11.html" title="Chapter 11 SML# feature: Multithread programming ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch12.html" title="Chapter 12 SML# feature: seamless SQL integration ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch13.html" title="Chapter 13 SML# feature: dynamic types and typed manipulation of JSON ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="chapter" href="Ch14.html" title="Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="part" href="Pt1.html" title="Part I Overview ‣ SML# Document Version 4.2.0">
<link rel="part" href="Pt2.html" title="Part II Tutorials ‣ SML# Document Version 4.2.0">
<link rel="part" href="Pt3.html" title="Part III Reference manual ‣ SML# Document Version 4.2.0">
<link rel="part" href="Pt4.html" title="Part IV Programming Tools ‣ SML# Document Version 4.2.0">
<link rel="part" href="Pt5.html" title="Part V SML# Internals and Data Structures ‣ SML# Document Version 4.2.0">
<link rel="part" href="Pt6.html" title="Part VI Bibliography and other documents ‣ SML# Document Version 4.2.0">
</head>
<body>
<div class="ltx_page_main">
<header class="ltx_page_header"><div class="ltx_document_title">SML# Document Version 4.2.0</div>
<div>
<a href="Ch14.html" title="Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0" class="ltx_ref" rel="up"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14 </span>
SML# feature: separate compilation</span></a><a href="Ch14.S3.html" title="14.3 Structure of interface files ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.3 </span>Structure of interface files</span></a><a href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.5 </span>Treatment of signatures</span></a>
</div></header>
<div class="ltx_page_content">
<section class="ltx_section ltx_authors_1line">
<h1 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">14.4 </span>Opaque types</h1>

<div id="p1" class="ltx_para">
<p class="ltx_p">The principle underlying interface declaration are the
following.</p>
<ol id="I1" class="ltx_enumerate">
<li id="I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="I1.i1.p1" class="ltx_para">
<p class="ltx_p">Define compile-time resources (static entities) such as <span class="ltx_text ltx_font_typewriter">datatype</span> and <span class="ltx_text ltx_font_typewriter">exception</span> themselves just the same way as they will
be defined in a source file.</p>
</div>
</li>
<li id="I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="I1.i2.p1" class="ltx_para">
<p class="ltx_p">Declare only the types of runtime resources such as functions
and variables.</p>
</div>
</li>
</ol>
<p class="ltx_p">They are necessary and sufficient information to compile other
source file that uses this interface file.
However, this principle alone cannot support ML’s information
hiding through opaque signatures.
For example, in the previous interface file <span class="ltx_text ltx_font_typewriter">queue.smi</span>,
the <span class="ltx_text ltx_font_typewriter">’a queue</span> type is explicitly defined to be <span class="ltx_text ltx_font_typewriter">Q of ’a list *
’a list</span> and this information is open to the user of this interface
file, but we often want to hide this implementation details.</p>
</div>
<div id="p2" class="ltx_para">
<p class="ltx_p">To solve this problem, the interface language introduces the
following opaque type declarations.
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">type <math id="p2.m1" class="ltx_Math" alttext="tyvars" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>s</mi></mrow></math> <math id="p2.m2" class="ltx_Math" alttext="tyid" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>i</mi><mi>d</mi></mrow></math> (= <math id="p2.m3" class="ltx_Math" alttext="typeRep" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>p</mi></mrow></math>)    
(* describe paranthesis as they are *)
<br class="ltx_break">
eqtype <math id="p2.m4" class="ltx_Math" alttext="tyvars" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>s</mi></mrow></math> <math id="p2.m5" class="ltx_Math" alttext="tyid" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>i</mi><mi>d</mi></mrow></math> (= <math id="p2.m6" class="ltx_Math" alttext="typeRep" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>p</mi></mrow></math>)    (* describe paranthesis as they are *)</span></p>
</blockquote>
<p class="ltx_p">These declaration reveals to the compiler that the internal
representation of <math id="p2.m7" class="ltx_Math" alttext="tyid" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>i</mi><mi>d</mi></mrow></math> is <math id="p2.m8" class="ltx_Math" alttext="typeRep" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>p</mi></mrow></math> but this information is not
available to the code that uses this interface file through <span class="ltx_text ltx_font_typewriter">_require</span> declaration.
As in signature, <span class="ltx_text ltx_font_typewriter">type</span> declaration defines a type on which
equality operation is not defined and <span class="ltx_text ltx_font_typewriter">eqtype</span> declaration defines a
type with on which equality operation is define.
<math id="p2.m9" class="ltx_Math" alttext="typeRep" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>p</mi></mrow></math> is the type constructor that implements the type
<math id="p2.m10" class="ltx_Math" alttext="tyid" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>i</mi><mi>d</mi></mrow></math>.
For example, consider the following implementation:</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">type t1 = int
<br class="ltx_break">
type t2 = int list
<br class="ltx_break">
type ’a t3 = (’a * ’a) array</span></p>
</blockquote>
<p class="ltx_p">One can write the following in the interface file:</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">type t1 (= int)
<br class="ltx_break">
type t2 (= list)
<br class="ltx_break">
type ’a t3 (= array)</span></p>
</blockquote>
<p class="ltx_p">If the implementation type is either a record type, tuple
type, or function type, then
<math id="p2.m11" class="ltx_Math" alttext="typeRep" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>p</mi></mrow></math> must be <span class="ltx_text ltx_font_typewriter">{}</span>, <span class="ltx_text ltx_font_typewriter">*</span>, or <span class="ltx_text ltx_font_typewriter">-&gt;</span>, respectively.
If the type is defined by <span class="ltx_text ltx_font_typewriter">datatype</span>, then
<math id="p2.m12" class="ltx_Math" alttext="typeRep" display="inline"><mrow><mi>t</mi><mi>y</mi><mi>p</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>p</mi></mrow></math> must be one of the following according to the definition of
its constructors:</p>
<ul id="I2" class="ltx_itemize">
<li id="I2.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I2.i1.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">unit</span>.
The type consists only of a single constructor that has no
argument.</p>
</div>
</li>
<li id="I2.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I2.i2.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">contag</span>.
The type consists only of more than one constructors with no
argument.</p>
</div>
</li>
<li id="I2.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I2.i3.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">boxed</span>.
Otherwise.</p>
</div>
</li>
</ul>
<p class="ltx_p">For example，to make <span class="ltx_text ltx_font_typewriter">datatype ’a queue</span> declaration in
<span class="ltx_text ltx_font_typewriter">queue.smi</span>, one can write the following.</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">type ’a queue (= boxed)
</span></p>
</blockquote>
</div>
<div id="p3" class="ltx_para">
<p class="ltx_p">Furthermore, as in signature, interface file need not
exhaustively list all the resources the implementation may define.
Only those resources defined in the interface file become
visible to the code that use it through <span class="ltx_text ltx_font_typewriter">_require</span> declaration.
</p>
</div>
</section>
</div>
<footer class="ltx_page_footer">
<div>
<a href="Ch14.S3.html" title="14.3 Structure of interface files ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.3 </span>Structure of interface files</span></a><a href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.2.0" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.5 </span>Treatment of signatures</span></a>
</div>
<div class="ltx_page_logo">Generated  on Tue Mar 25 14:56:23 2025 by <a href="http://dlmf.nist.gov/LaTeXML/">LaTeXML <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="[LOGO]"></a>
</div></footer>
</div>
</body>
</html>
