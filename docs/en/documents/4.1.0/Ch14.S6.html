---
layout: default
permalink: /en/documents/4.1.0/Ch14.S6.html
translated: true
lang: en
head: |
 <!--Generated on Sat Nov 16 16:42:06 2024 by LaTeXML (version 0.8.5) http://dlmf.nist.gov/LaTeXML/.-->
 <!--Document created on Nov, 2024.-->
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <link rel="stylesheet" href="LaTeXML.css" type="text/css">
 <link rel="stylesheet" href="ltx-book.css" type="text/css">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=MML_CHTML" type="text/javascript"></script>
 <link rel="up" href="Ch14.html" title="Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="up up" href="Pt2.html" title="Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="up up up" href="./" title="SML# Document Version 4.1.0">
 <link rel="start" href="./" title="SML# Document Version 4.1.0">
 <link rel="prev" href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="next" href="Ch14.S7.html" title="14.7 Replications ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S1.html" title="14.1 Separate compilation overview ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S2.html" title="14.2 Separate compilation example ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S3.html" title="14.3 Structure of interface files ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S4.html" title="14.4 Opaque types ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S7.html" title="14.7 Replications ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch14.S8.html" title="14.8 Top-level execution ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch5.html" title="Chapter 5 Installing SML# ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch6.html" title="Chapter 6 Setting up SML# programming environment ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch7.html" title="Chapter 7 Introduction to ML programming ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch8.html" title="Chapter 8 SML# feature: record polymorphism ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch9.html" title="Chapter 9 SML# feature: other type system extensions ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch10.html" title="Chapter 10 SML# feature: direct interface to C ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch11.html" title="Chapter 11 SML# feature: Multithread programming ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch12.html" title="Chapter 12 SML# feature: seamless SQL integration ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch13.html" title="Chapter 13 SML# feature: dynamic types and typed manipulation of JSON ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch14.html" title="Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt1.html" title="Part I Overview ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt2.html" title="Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt3.html" title="Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt4.html" title="Part IV Programming Tools ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt5.html" title="Part V SML# Internals and Data Structures ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt6.html" title="Part VI Bibliography and other documents ‣ SML# Document Version 4.1.0">
title: "14.6 Functor support‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0"
---
{% raw %}
<div class="ltx_page_main">
<header class="ltx_page_header"><div class="ltx_document_title">SML# Document Version 4.1.0</div>
<div>
<a href="Ch14.html" title="Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="up"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14 </span>
SML# feature: separate compilation</span></a><a href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.5 </span>Treatment of signatures</span></a><a href="Ch14.S7.html" title="14.7 Replications ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.7 </span>Replications</span></a>
</div></header>
<div class="ltx_page_content">
<section class="ltx_section ltx_authors_1line">
<h1 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">14.6 </span>Functor support</h1>

<div id="p1" class="ltx_para">
<p class="ltx_p">SML# can separately compile functor into an object file,
and can be used from other compilation unit through <span class="ltx_text ltx_font_typewriter">_require</span>
declaration.
To provide a functor, write the following in its interface file.</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">functor <math id="p1.m1" class="ltx_Math" alttext="id" display="inline"><mrow><mi>i</mi><mi>d</mi></mrow></math>(<math id="p1.m2" class="ltx_Math" alttext="signature" display="inline"><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi></mrow></math>) =
<br class="ltx_break">
struct
<br class="ltx_break">
  (* the same as Provide declarations of structure *)
<br class="ltx_break">
end</span></p>
</blockquote>
<p class="ltx_p"><math id="p1.m3" class="ltx_Math" alttext="signature" display="inline"><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi></mrow></math> is a Standard ML signature.
Below is an example of an interface file for binary search tree.</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">_require "basis.smi"
<br class="ltx_break">
functor BalancedBinaryTree
<br class="ltx_break">
  (A:sig
<br class="ltx_break">
      type key
<br class="ltx_break">
      val comp : key * key -&gt; order
<br class="ltx_break">
    end
<br class="ltx_break">
  ) =
<br class="ltx_break">
struct
<br class="ltx_break">
  type ’a binaryTree (= boxed)
<br class="ltx_break">
  val empty : ’a binaryTree
<br class="ltx_break">
  val isEmpty : ’a binaryTree -&gt; bool
<br class="ltx_break">
  val singleton : key * ’a -&gt; ’a binaryTree
<br class="ltx_break">
  val insert : ’a binaryTree * A.key * ’a -&gt; ’a binaryTree
<br class="ltx_break">
  val delete : ’a binaryTree * key -&gt; ’a binaryTree
<br class="ltx_break">
  val find : ’a binaryTree * A.key -&gt; ’a option
<br class="ltx_break">
end</span></p>
</blockquote>
</div>
<div id="p2" class="ltx_para">
<p class="ltx_p">In using functors in separate compilation, one should note the
following.</p>
<ul id="I1" class="ltx_itemize">
<li id="I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I1.i1.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Functor is not a mechanism for separate compilation.</span>
In some existing practice of ML, probably due to the lack of
separate compilation, functors can be used to compile some modules
independently from the others.
For example, if one write</p>
<blockquote class="ltx_quote">
<span class="ltx_inline-para ltx_minipage ltx_align_middle" style="width:407.2pt;">
<span id="I1.i1.p1.p1" class="ltx_para">
<span class="ltx_p">A.sml file:</span>
<span class="ltx_quote">
<span class="ltx_p"><span class="ltx_text ltx_font_typewriter">structure A =
<br class="ltx_break">
struct
<br class="ltx_break">
  ...
<br class="ltx_break">
end</span></span>
</span>
<span class="ltx_p">B.sml file:</span>
<span class="ltx_quote">
<span class="ltx_p"><span class="ltx_text ltx_font_typewriter">structure B = 
<br class="ltx_break">
struct
<br class="ltx_break">
  open A
<br class="ltx_break">
  ...
<br class="ltx_break">
end</span></span>
</span>
</span></span>
</blockquote>
<p class="ltx_p">then <span class="ltx_text ltx_font_typewriter">B.sml</span> file directly depends on <span class="ltx_text ltx_font_typewriter">A.sml</span> file.
If one rewrite <span class="ltx_text ltx_font_typewriter">B.sml</span> using a functor as below then this
dependency can be avoided.</p>
<blockquote class="ltx_quote">
<span class="ltx_inline-para ltx_minipage ltx_align_middle" style="width:407.2pt;">
<span id="I1.i1.p1.p2" class="ltx_para">
<span class="ltx_p">B.sml file:</span>
<span class="ltx_quote">
<span class="ltx_p"><span class="ltx_text ltx_font_typewriter">functor B(A:sig ... end) = 
<br class="ltx_break">
struct
<br class="ltx_break">
  open A
<br class="ltx_break">
  ...
<br class="ltx_break">
end
</span></span>
</span>
</span></span>
</blockquote>
<p class="ltx_p">This is exactly what separate compilation achieves.
A system such as SML# where a complete separate
compilation is supported, this form of functor usage is unnecessary
and undesirable.</p>
</div>
</li>
<li id="I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I1.i2.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Usage of functor incurs some overhead.</span>
Functors can take types as parameters and therefore strictly
more powerful than polymorphic functions.
However, this type parameterization requires the compiler to
generate code that behaves differently depending on the argument types.
The resulting code inevitably incurs more overhead than the
corresponding code with the type argument predetermined (i.e. ordinary
structures).
The programmer who use functor should be aware of this const and
restrict functors in cases where the advanced feature of explicit type
parameterization is really required.</p>
</div>
</li>
</ul>
</div>
<div id="p3" class="ltx_para">
<p class="ltx_p">In the current version of SML# has the following limitation
on the usage of functors.</p>
<ul id="I2" class="ltx_itemize">
<li id="I2.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I2.i1.p1" class="ltx_para">
<p class="ltx_p">If a functor has a formal abstract type constructor with type
arguments, only heap-allocated internal representations (such as
<span class="ltx_text ltx_font_typewriter">array</span>, <span class="ltx_text ltx_font_typewriter">boxed</span>, <span class="ltx_text ltx_font_typewriter">{}</span>, <span class="ltx_text ltx_font_typewriter">-&gt;</span>, and <span class="ltx_text ltx_font_typewriter">*</span>)
can be applied to the formal type constructor.
The following example causes a compile error in SML#.</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter"># functor F(type ’a t) = struct end
structure X = F(type ’a t = int);
<br class="ltx_break">
(interactive):2.17-2.34 Error:
<br class="ltx_break">
(name evaluation "440") Functor parameter restriction: t</span></p>
</blockquote>
</div>
</li>
</ul>
</div>
</section>
</div>
<footer class="ltx_page_footer">
<div>
<a href="Ch14.S5.html" title="14.5 Treatment of signatures ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.5 </span>Treatment of signatures</span></a><a href="Ch14.S7.html" title="14.7 Replications ‣ Chapter 14 SML# feature: separate compilation ‣ Part II Tutorials ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14.7 </span>Replications</span></a>
</div>
<div class="ltx_page_logo">Generated  on Sat Nov 16 16:42:06 2024 by <a href="http://dlmf.nist.gov/LaTeXML/">LaTeXML <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="[LOGO]"></a>
</div></footer>
</div>
{% endraw %}
