---
layout: default
permalink: /en/documents/4.1.0/Ch22.S7.html
translated: true
lang: en
head: |
 <!--Generated on Sat Nov 16 16:42:06 2024 by LaTeXML (version 0.8.5) http://dlmf.nist.gov/LaTeXML/.-->
 <!--Document created on Nov, 2024.-->
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <link rel="stylesheet" href="LaTeXML.css" type="text/css">
 <link rel="stylesheet" href="ltx-book.css" type="text/css">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=MML_CHTML" type="text/javascript"></script>
 <link rel="up" href="Ch22.html" title="Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="up up" href="Pt3.html" title="Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="up up up" href="./" title="SML# Document Version 4.1.0">
 <link rel="start" href="./" title="SML# Document Version 4.1.0">
 <link rel="prev" href="Ch22.S6.html" title="22.6 SQL commands ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="next" href="Ch22.S8.html" title="22.8 SQL Library: The SQL Structure ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S1.html" title="22.1 SQL Types ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S2.html" title="22.2 Extended ML Expressions for SQL Queries ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S3.html" title="22.3 Database Server Description: The _sqlserver Expression ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S4.html" title="22.4 SQL Value Expressions ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S5.html" title="22.5 SELECT queries ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S6.html" title="22.6 SQL commands ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S8.html" title="22.8 SQL Library: The SQL Structure ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S9.html" title="22.9 SQL Library: The SQL.Op structure ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S10.html" title="22.10 SQL Library: The SQL.Numeric Structure ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="section" href="Ch22.S11.html" title="22.11 Difference from the standard SQL (Informative) ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch15.html" title="Chapter 15 Introduction ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch16.html" title="Chapter 16 The SML# Structure ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch17.html" title="Chapter 17 Lexical structure ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch18.html" title="Chapter 18 Types ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch19.html" title="Chapter 19 Expressions ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch20.html" title="Chapter 20 Patterns and Pattern Matching ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch21.html" title="Chapter 21 Scope rules for identifier ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch22.html" title="Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch23.html" title="Chapter 23 Declarations of the core language and their interfaces ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch24.html" title="Chapter 24 Module language declarations and interface ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch25.html" title="Chapter 25 Overview of SML# Libraries ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch26.html" title="Chapter 26 Standard ML Basis Library ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch27.html" title="Chapter 27 SML# System Library ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch28.html" title="Chapter 28 The smlsharp command ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="chapter" href="Ch29.html" title="Chapter 29 SML# Run-time data management ‣ Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt1.html" title="Part I Overview ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt2.html" title="Part II Tutorials ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt3.html" title="Part III Reference manual ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt4.html" title="Part IV Programming Tools ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt5.html" title="Part V SML# Internals and Data Structures ‣ SML# Document Version 4.1.0">
 <link rel="part" href="Pt6.html" title="Part VI Bibliography and other documents ‣ SML# Document Version 4.1.0">
title: "22.7 SQL execution function expressions‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0"
---
{% raw %}
<div class="ltx_page_main">
<header class="ltx_page_header"><div class="ltx_document_title">SML# Document Version 4.1.0</div>
<div>
<a href="Ch22.html" title="Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="up"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">22 </span>SQL Expressions and Commands</span></a><a href="Ch22.S6.html" title="22.6 SQL commands ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">22.6 </span>SQL commands</span></a><a href="Ch22.S8.html" title="22.8 SQL Library: The SQL Structure ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">22.8 </span>SQL Library: The SQL Structure</span></a>
</div></header>
<div class="ltx_page_content">
<section class="ltx_section ltx_authors_1line">
<h1 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">22.7 </span>SQL execution function expressions</h1>

<div id="p1" class="ltx_para">
<p class="ltx_p">An SQL execution function
<span class="ltx_text ltx_font_typewriter">_sql <math id="p1.m1" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo mathvariant="normal" stretchy="false">⟨</mo></mrow></math></span><span class="ltx_text ltx_font_italic">pat<span class="ltx_text ltx_font_typewriter ltx_font_upright"><math id="p1.m2" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span><span class="ltx_text ltx_font_typewriter"> =&gt; <math id="p1.m3" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo mathvariant="normal" stretchy="false">⟨</mo></mrow></math></span><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_typewriter ltx_font_upright"><math id="p1.m4" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span>
generates a function
that executes the SQL command <math id="p1.m5" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_upright"><math id="p1.m6" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span> on a database server.
By applying this function to a connection handle to a database,
the <math id="p1.m7" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_upright"><math id="p1.m8" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span> expression is evaluated and the resulting SQL command
is sent to the server.
This function returns the execution result
if the execusion is successfully done, or
raises the <span class="ltx_text ltx_font_typewriter">SQL.Exec</span> exception otherwise.
This function behaves as the following:
</p>
<ol id="I1" class="ltx_enumerate">
<li id="I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="I1.i1.p1" class="ltx_para">
<p class="ltx_p">It receives a connection handle of the <math id="I1.i1.p1.m1" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math><span class="ltx_text ltx_font_typewriter"> SQL.conn</span> type
as its argument.
</p>
</div>
</li>
<li id="I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="I1.i2.p1" class="ltx_para">
<p class="ltx_p">It obtains an database instance of the <span class="ltx_text ltx_font_typewriter">(<math id="I1.i2.p1.m1" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math>, <math id="I1.i2.p1.m2" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.db</span>
type from the connection handle and
binds the pattern <math id="I1.i2.p1.m3" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">pat<span class="ltx_text ltx_font_upright"><math id="I1.i2.p1.m4" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span> to it.
</p>
</div>
</li>
<li id="I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span> 
<div id="I1.i3.p1" class="ltx_para">
<p class="ltx_p">It evaluates the expression <math id="I1.i3.p1.m1" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_upright"><math id="I1.i3.p1.m2" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span> and obtains the
command of type <span class="ltx_text ltx_font_typewriter">(<math id="I1.i3.p1.m3" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo mathvariant="normal">′</mo></msup></mrow></math>, <math id="I1.i3.p1.m4" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.command</span>.
Exceptionally, if <math id="I1.i3.p1.m5" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sql<span class="ltx_text ltx_font_upright"><math id="I1.i3.p1.m6" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span> is of the form <math id="I1.i3.p1.m7" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlselect<span class="ltx_text ltx_font_upright"><math id="I1.i3.p1.m8" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span>,
it interprets
an SELECT query of type <span class="ltx_text ltx_font_typewriter">(<math id="I1.i3.p1.m9" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math>, <math id="I1.i3.p1.m10" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.query</span>
as an SQL command of type <span class="ltx_text ltx_font_typewriter">(<math id="I1.i3.p1.m11" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math> SQL.cursor, <math id="I1.i3.p1.m12" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.command</span>.
</p>
</div>
</li>
<li id="I1.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span> 
<div id="I1.i4.p1" class="ltx_para">
<p class="ltx_p">It serializes the command and sends it to the server.
</p>
</div>
</li>
<li id="I1.i5" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">5.</span> 
<div id="I1.i5.p1" class="ltx_para">
<p class="ltx_p">If succeeded,
it returns the result of type <math id="I1.i5.p1.m1" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo>′</mo></msup></mrow></math>.
</p>
</div>
</li>
</ol>
<p class="ltx_p">As seen in these steps,
the type of the execution function is
<math id="p1.m9" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math><span class="ltx_text ltx_font_typewriter"> SQL.conn -&gt; <math id="p1.m10" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo mathvariant="normal">′</mo></msup></mrow></math></span>
when the type of the command is
<span class="ltx_text ltx_font_typewriter">(<math id="p1.m11" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math>, <math id="p1.m12" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.db -&gt; (<math id="p1.m13" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo mathvariant="normal">′</mo></msup></mrow></math>, <math id="p1.m14" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.command</span>.
Typically,
<math id="p1.m15" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo>′</mo></msup></mrow></math> is either
<span class="ltx_text ltx_font_typewriter">SQL.cursor</span> if <math id="p1.m16" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_upright"><math id="p1.m17" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span> is <math id="p1.m18" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlselect<span class="ltx_text ltx_font_upright"><math id="p1.m19" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span>,
or <span class="ltx_text ltx_font_typewriter">unit</span> otherwise.
</p>
</div>
<div id="p2" class="ltx_para">
<p class="ltx_p">The most simple way to execute an SQL query or command is
to write it in an SQL execution function directly.
For example,
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">val q = _sql db =&gt; select #t.name as name, #t.age as age
<br class="ltx_break">
                   from #db.employee as t
<br class="ltx_break">
                   where #t.salary &gt;= 300
<br class="ltx_break">
                   order by #.age</span></p>
</blockquote>
<p class="ltx_p">is the function <span class="ltx_text ltx_font_typewriter">q</span> that execute the query.
To execute the query whose clauses are independently constructed,
use
the <span class="ltx_text ltx_font_typewriter">select...(<math id="p2.m1" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo mathvariant="normal" stretchy="false">⟨</mo></mrow></math></span><span class="ltx_text ltx_font_italic">exp<span class="ltx_text ltx_font_typewriter ltx_font_upright"><math id="p2.m2" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span><span class="ltx_text ltx_font_typewriter">)</span> notation
in the body of an SQL execution function, as seen in the following:
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">val s = _sql select #t.name as name, #t.age as age
<br class="ltx_break">
val f = fn db =&gt; _sql from #db.employee as t
<br class="ltx_break">
val g = fn db =&gt; select...(s) from...(f db)
<br class="ltx_break">
val q = _sql db =&gt; select...(q db)</span></p>
</blockquote>
</div>
<div id="p3" class="ltx_para">
<p class="ltx_p">For SQL commands,
write it directly in an SQL execution function.
For example,
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">val w = fn () =&gt; _sql where #employee.name = "Taro"
<br class="ltx_break">
val c = fn db =&gt; _sql update #db.employee
<br class="ltx_break">
                      set āge = #employee.age + 1,
<br class="ltx_break">
                      salary = #employee.salary + 100
<br class="ltx_break">
                      where...(w ())
<br class="ltx_break">
val q = _sql db =&gt; ...(c db)</span></p>
</blockquote>
</div>
<div id="p4" class="ltx_para">
<p class="ltx_p">The typing rules of the SQL execution functions are the following:
</p>
<ul id="I2" class="ltx_itemize">
<li id="I2.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I2.i1.p1" class="ltx_para">
<p class="ltx_p">In the type of <math id="I2.i1.p1.m1" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_upright"><math id="I2.i1.p1.m2" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span>,
which is either
<span class="ltx_text ltx_font_typewriter">(<math id="I2.i1.p1.m3" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math>,<math id="I2.i1.p1.m4" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.command</span> or
<span class="ltx_text ltx_font_typewriter">(<math id="I2.i1.p1.m5" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo mathvariant="normal">′</mo></msup></mrow></math>,<math id="I2.i1.p1.m6" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.query</span>,
the <math id="I2.i1.p1.m7" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math> must be the type variable occuring only in the type of <math id="I2.i1.p1.m8" class="ltx_Math" alttext="\,\langle" display="inline"><mrow><mspace width="1.66666666666667pt"></mspace><mo stretchy="false">⟨</mo></mrow></math><span class="ltx_text ltx_font_italic">sqlfn<span class="ltx_text ltx_font_upright"><math id="I2.i1.p1.m9" class="ltx_Math" alttext="\rangle\," display="inline"><mrow><mo mathvariant="normal" stretchy="false">⟩</mo><mspace width="1.66666666666667pt"></mspace></mrow></math></span></span>.
</p>
</div>
</li>
</ul>
<p class="ltx_p">This restriction is
introduced to avoid queries across multiple databases.
For example, the following causes a type error:
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter"># fun f exp = _sql db =&gt; select #e.name, (...exp) from #db.employee as e;
<br class="ltx_break">
(interactive):1.12-1.65 Error:
<br class="ltx_break">
  (type inference 067) User type variable cannot be generalized: ’$h</span></p>
</blockquote>
<p class="ltx_p">The formal reason of this error is that
the <math id="p4.m1" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math> of <span class="ltx_text ltx_font_typewriter">(<math id="p4.m2" class="ltx_Math" alttext="\tau" display="inline"><mi>τ</mi></math>,<math id="p4.m3" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.query</span>, which is the type of
<span class="ltx_text ltx_font_typewriter">select <math id="p4.m4" class="ltx_Math" alttext="\cdots" display="inline"><mi mathvariant="normal">⋯</mi></math></span>,
is also used in
the type of the <span class="ltx_text ltx_font_typewriter">exp</span> argument, <span class="ltx_text ltx_font_typewriter">(<math id="p4.m5" class="ltx_Math" alttext="\tau^{\prime}" display="inline"><mrow><mi>τ</mi><msup><mi></mi><mo mathvariant="normal">′</mo></msup></mrow></math>,<math id="p4.m6" class="ltx_Math" alttext="w" display="inline"><mi>w</mi></math>) SQL.exp</span>,
since <span class="ltx_text ltx_font_typewriter">exp</span> of the argument of <span class="ltx_text ltx_font_typewriter">f</span> is included in <span class="ltx_text ltx_font_typewriter">select</span>,
and therefore the above restriction is violated.
From the practical perspective,
this is an error because
the <span class="ltx_text ltx_font_typewriter">exp</span> argument may be an SQL value expression related to
the database different from the <span class="ltx_text ltx_font_typewriter">db</span> of
<span class="ltx_text ltx_font_typewriter">_sql db =&gt; <math id="p4.m7" class="ltx_Math" alttext="\cdots" display="inline"><mi mathvariant="normal">⋯</mi></math></span>.
To understand the situation,
consider another following function that calls <span class="ltx_text ltx_font_typewriter">f</span>:
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">fun badExample conn1 conn2 =
<br class="ltx_break">
    (_sql db2 =&gt;
<br class="ltx_break">
          select...((f _sql((select #t1.c1 from #db2.t1)) conn1;
<br class="ltx_break">
                     _sql(select #t2.c2 from #db2.t2))))
<br class="ltx_break">
      conn2</span></p>
</blockquote>
<p class="ltx_p">If <span class="ltx_text ltx_font_typewriter">f</span> is a polymorphic function,
the <span class="ltx_text ltx_font_typewriter">badExample</span> function is also typed regardless of the
above type restriction.
The <span class="ltx_text ltx_font_typewriter">badExample</span> function receives
two connection handle <span class="ltx_text ltx_font_typewriter">conn1</span> and <span class="ltx_text ltx_font_typewriter">conn2</span>, which point to
possibly different databases,
and executes the query of the function <span class="ltx_text ltx_font_typewriter">f</span> and another query
on <span class="ltx_text ltx_font_typewriter">conn1</span> and <span class="ltx_text ltx_font_typewriter">conn2</span>, respectively.
Its strange behavior
is that it executes the query of <span class="ltx_text ltx_font_typewriter">f</span> in an SQL execution function.
In addition,
it applies <span class="ltx_text ltx_font_typewriter">f</span> to a subquery on <span class="ltx_text ltx_font_typewriter">db2</span> of <span class="ltx_text ltx_font_typewriter">conn2</span>, not
<span class="ltx_text ltx_font_typewriter">conn1</span>.
Concequently,
the query executed in <span class="ltx_text ltx_font_typewriter">f</span> refers to the two databases,
one of which is referred to as <span class="ltx_text ltx_font_typewriter">db</span> in <span class="ltx_text ltx_font_typewriter">f</span>,
and another of which is referred to as <span class="ltx_text ltx_font_typewriter">db2</span> in <span class="ltx_text ltx_font_typewriter">badExample</span>.
Such a query cannot be executed.
</p>
</div>
<div id="p5" class="ltx_para">
<p class="ltx_p">In practice, the place in which an SQL execution function can place
is limited due to this restriction.
In particular,
as seen in the above <span class="ltx_text ltx_font_typewriter">f</span>,
a function that executes a given query as an argument is not allowed.
To avoid this limitation,
you should distinguish between query construction functions and
query execution functions.
For example, if the above <span class="ltx_text ltx_font_typewriter">f</span> is rewritten so that
it constructs a query rather than executes it as follow,
then the type error is avoided:
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">fun f exp = fn db =&gt; _sql select #e.name, (...exp) from #db.employee as e
<br class="ltx_break">
val q = _sql db =&gt; select...(f _sql(#e.saraly) db)</span></p>
</blockquote>
</div>
<div id="p6" class="ltx_para">
<p class="ltx_p">The <span class="ltx_text ltx_font_typewriter">SQL.Exec</span> exception is raised in the following
situations:
</p>
<ol id="I3" class="ltx_enumerate">
<li id="I3.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="I3.i1.p1" class="ltx_para">
<p class="ltx_p">Constraint violation other than NOT NULL.
</p>
</div>
</li>
<li id="I3.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="I3.i2.p1" class="ltx_para">
<p class="ltx_p">Overflow of integers or strings.
</p>
</div>
</li>
<li id="I3.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span> 
<div id="I3.i3.p1" class="ltx_para">
<p class="ltx_p">Division by zero.
</p>
</div>
</li>
<li id="I3.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span> 
<div id="I3.i4.p1" class="ltx_para">
<p class="ltx_p">The use of an SQL syntax that SML# supports but
the database server cannot interpret.
</p>
</div>
</li>
</ol>
<p class="ltx_p">Notes on 4.:
the SQL syntax of SML# is designed based on the SQL99 standard
extended with popular extensions among major database engines and
natural extension
in the sence of functional programming langauges.
The compliance with the standard SQL and the detail of
interpretation rules of SQL queries may depend on the implementation
of the database servers.
Therefore,
the programmer should not use SML#’s SQL syntax with no limitation
but choose its subset in accordance with the manual of the database server
to be used.
The following are such incompatibilities known at the time when
this manual is authored:
</p>
<ul id="I4" class="ltx_itemize">
<li id="I4.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I4.i1.p1" class="ltx_para">
<p class="ltx_p">PostgreSQL ignores <span class="ltx_text ltx_font_typewriter">AS</span> in a FROM clause if the <span class="ltx_text ltx_font_typewriter">AS</span>
occur in a join expression labeled with <span class="ltx_text ltx_font_typewriter">AS</span>.
For example, the following query causes an error since
<span class="ltx_text ltx_font_typewriter">x</span> is undefined:
</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_typewriter">SELECT x.col FROM (a AS x NATURAL JOIN b AS y) AS z</span></p>
</blockquote>
</div>
</li>
<li id="I4.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="I4.i2.p1" class="ltx_para">
<p class="ltx_p">SQLite3 does not support the <span class="ltx_text ltx_font_typewriter">group by ()</span> notation,
which is introduced in SQL99.
Use <span class="ltx_text ltx_font_typewriter">group by ""</span> instead.
</p>
</div>
</li>
</ul>
</div>
</section>
</div>
<footer class="ltx_page_footer">
<div>
<a href="Ch22.S6.html" title="22.6 SQL commands ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">22.6 </span>SQL commands</span></a><a href="Ch22.S8.html" title="22.8 SQL Library: The SQL Structure ‣ Chapter 22 SQL Expressions and Commands ‣ Part III Reference manual ‣ SML# Document Version 4.1.0" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">22.8 </span>SQL Library: The SQL Structure</span></a>
</div>
<div class="ltx_page_logo">Generated  on Sat Nov 16 16:42:06 2024 by <a href="http://dlmf.nist.gov/LaTeXML/">LaTeXML <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="[LOGO]"></a>
</div></footer>
</div>
{% endraw %}
